<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Crear cuenta — Ejercicio 1</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width:600px; }
  label { display:block; margin-top:12px; }
  input[type="text"], input[type="email"], input[type="password"], input[type="number"] {
    width:100%; padding:8px; box-sizing:border-box;
  }
  .error { color: #c00; font-size:0.9em; margin-top:4px; }
  .field { margin-bottom:6px; }
  button[disabled] { opacity:0.6; cursor:not-allowed; }
</style>
</head>
<body>

<h1>Crear cuenta</h1>
<form id="form1" novalidate>
  <div class="field">
    <label for="name">Nombre</label>
    <input id="name" name="name" type="text" />
    <div id="err-name" class="error" aria-live="polite"></div>
  </div>

  <div class="field">
    <label for="email">Correo electrónico</label>
    <input id="email" name="email" type="email" />
    <div id="err-email" class="error" aria-live="polite"></div>
  </div>

  <div class="field">
    <label for="password">Contraseña</label>
    <input id="password" name="password" type="password" />
    <div id="err-password" class="error" aria-live="polite"></div>
  </div>

  <div class="field">
    <label for="password2">Repetir contraseña</label>
    <input id="password2" name="password2" type="password" />
    <div id="err-password2" class="error" aria-live="polite"></div>
  </div>

  <div class="field">
    <label id="captcha-label">Captcha: <span id="a">0</span> + <span id="b">0</span> = ?</label>
    <input id="captcha" name="captcha" type="number" />
    <div id="err-captcha" class="error" aria-live="polite"></div>
  </div>

  <div class="field">
    <label><input id="accept" type="checkbox" /> Acepto las condiciones</label>
    <div id="err-accept" class="error" aria-live="polite"></div>
  </div>

  <div style="margin-top:12px;">
    <button id="submitBtn" type="submit" disabled>Crear cuenta</button>
  </div>
</form>

<script>
(function(){
  const form = document.getElementById('form1');
  const nameEl = document.getElementById('name');
  const emailEl = document.getElementById('email');
  const passwordEl = document.getElementById('password');
  const password2El = document.getElementById('password2');
  const captchaEl = document.getElementById('captcha');
  const aSpan = document.getElementById('a');
  const bSpan = document.getElementById('b');
  const acceptEl = document.getElementById('accept');
  const submitBtn = document.getElementById('submitBtn');

  // error elements
  const err = {
    name: document.getElementById('err-name'),
    email: document.getElementById('err-email'),
    password: document.getElementById('err-password'),
    password2: document.getElementById('err-password2'),
    captcha: document.getElementById('err-captcha'),
    accept: document.getElementById('err-accept')
  };

  // generar captcha (dos dígitos enteros aleatorios 1..9)
  let a = 0, b = 0;
  function newCaptcha(){
    a = Math.floor(Math.random()*9) + 1;
    b = Math.floor(Math.random()*9) + 1;
    aSpan.textContent = a;
    bSpan.textContent = b;
  }
  newCaptcha();

  // validadores
  function validateName() {
    const v = nameEl.value.trim();
    if (!v) {
      showError('name', 'El nombre no puede estar vacío.');
      nameEl.focus();
      return false;
    }
    clearError('name'); return true;
  }

  function validateEmail() {
    const v = emailEl.value.trim();
    // regex simple para email (no perfecto pero suficiente para ejercicio)
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!re.test(v)) {
      showError('email', 'La dirección de correo debe ser válida.');
      emailEl.focus();
      return false;
    }
    clearError('email'); return true;
  }

  function validatePassword() {
    const v = passwordEl.value;
    // al menos 8 caracteres y al menos un dígito
    const re = /^(?=.*\d).{8,}$/;
    if (!re.test(v)) {
      showError('password', 'La contraseña debe tener al menos 8 caracteres y contener al menos un dígito.');
      passwordEl.focus();
      return false;
    }
    clearError('password'); return true;
  }

  function validatePassword2() {
    if (password2El.value !== passwordEl.value) {
      showError('password2', 'La repetición debe coincidir con la contraseña.');
      password2El.focus();
      return false;
    }
    clearError('password2'); return true;
  }

  function validateCaptcha() {
    const v = parseInt(captchaEl.value, 10);
    if (Number.isNaN(v) || v !== (a + b)) {
      showError('captcha', 'El resultado de la suma es incorrecto.');
      captchaEl.focus();
      return false;
    }
    clearError('captcha'); return true;
  }

  function validateAccept() {
    if (!acceptEl.checked) {
      showError('accept', 'Debes aceptar las condiciones para crear la cuenta.');
      return false;
    }
    clearError('accept'); return true;
  }

  // utilidades mostrar/limpiar errores
  function showError(field, message) {
    err[field].textContent = message;
  }
  function clearError(field) {
    err[field].textContent = '';
  }

  // eventos individualizados
  nameEl.addEventListener('blur', validateName);
  emailEl.addEventListener('blur', validateEmail);
  passwordEl.addEventListener('blur', validatePassword);
  password2El.addEventListener('blur', validatePassword2);
  captchaEl.addEventListener('blur', validateCaptcha);

  // habilitar botón cuando checkbox activado
  acceptEl.addEventListener('change', function(){
    submitBtn.disabled = !acceptEl.checked;
    if (acceptEl.checked) clearError('accept');
  });

  // submit
  form.addEventListener('submit', function(e){
    e.preventDefault();
    // validar todos
    if (!validateName()) return;
    if (!validateEmail()) return;
    if (!validatePassword()) return;
    if (!validatePassword2()) return;
    if (!validateCaptcha()) return;
    if (!validateAccept()) {
      // dar foco al checkbox
      acceptEl.focus();
      return;
    }

    // Si todo correcto — aquí podrías enviar por fetch o form.submit
    alert('Cuenta creada con éxito (simulado).');
    // opcional: regenerar captcha y limpiar formulario
    newCaptcha();
    form.reset();
    submitBtn.disabled = true;
  });
})();
</script>

</body>
</html>
